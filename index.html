<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ„¤æ€’çš„å°é¸Ÿï¼šç»ˆæä¼˜åŒ–ç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #87CEEB; font-family: 'Segoe UI', sans-serif; user-select: none; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .hud-text { font-weight: 900; text-shadow: 2px 2px 0 rgba(0,0,0,0.3); }
        
        /* èƒœåˆ©åŠ¨ç”» */
        #level-card {
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: scale(0);
        }
        #level-card.active { transform: scale(1); }
    </style>
</head>
<body>

    <!-- æ¸¸æˆç”»å¸ƒ -->
    <div id="game-container" class="relative w-full h-full"></div>

    <!-- UI å±‚ -->
    <div id="ui-layer" class="flex flex-col justify-between p-6">
        <div class="flex justify-between items-start">
            <div class="text-white">
                <div class="text-2xl hud-text">LEVEL <span id="level-display">1</span></div>
                <div class="text-lg opacity-80">Score: <span id="score-display">0</span></div>
            </div>
            <button onclick="Game.resetLevel()" class="pointer-events-auto bg-white/20 hover:bg-white/40 backdrop-blur-md text-white p-3 rounded-full transition">
                ğŸ”„
            </button>
        </div>

        <!-- å…³å¡ç»“ç®—å¡ç‰‡ -->
        <div id="level-card" class="absolute inset-0 flex items-center justify-center pointer-events-none">
            <div class="bg-white rounded-2xl p-8 shadow-2xl text-center pointer-events-auto transform transition-all border-4 border-yellow-400">
                <div class="text-6xl mb-2">â­</div>
                <h2 class="text-3xl font-black text-gray-800 mb-2">VICTORY!</h2>
                <p class="text-gray-500 mb-6">çŒªçŒªå·²è¢«æ¶ˆç­</p>
                <button onclick="Game.nextLevel()" class="bg-yellow-400 hover:bg-yellow-500 text-black font-bold py-3 px-8 rounded-full text-lg shadow-lg transform active:scale-95 transition">
                    ä¸‹ä¸€å…³ â–¶
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- æ¸¸æˆå¼•æ“å°è£… ---
        const Game = (() => {
            // Matter.js æ¨¡å—
            const { Engine, Render, Runner, World, Bodies, Body, Composite, Events, Constraint, Mouse, MouseConstraint, Vector, Detector } = Matter;

            let engine, render, runner, mouseConstraint;
            let bird, sling, anchor;
            let entities = { pigs: [], blocks: [], particles: [] };
            let currentLevel = 0;
            let score = 0;
            let isFired = false;

            // å…³å¡è®¾è®¡æ•°æ®
            const levels = [
                // Level 1: ç®€å•å¡”
                {
                    setup: (w, h) => {
                        createStructure(w - 300, h - 20, [
                            ['wood', 20, 100, 0, 0], ['wood', 20, 100, 100, 0],
                            ['wood', 140, 20, 50, -60],
                            ['pig', 0, 0, 50, 0]
                        ]);
                    }
                },
                // Level 2: çŸ³å¤´å ¡å’
                {
                    setup: (w, h) => {
                        createStructure(w - 400, h - 20, [
                            ['stone', 30, 120, 0, 0], ['stone', 30, 120, 120, 0],
                            ['wood', 180, 20, 60, -70],
                            ['pig', 0, 0, 60, 0],
                            ['wood', 20, 80, 60, -120],
                            ['pig', 0, 0, 60, -170]
                        ]);
                    }
                },
                // Level 3: é‡‘å­—å¡”
                {
                    setup: (w, h) => {
                        const startX = w - 500;
                        const startY = h - 20;
                        for(let i=0; i<3; i++) {
                            createBlock(startX + i*80, startY-30, 20, 60, 'wood');
                            createPig(startX + i*80 + 40, startY-15);
                            createBlock(startX + i*80 + 80, startY-30, 20, 60, 'wood');
                            createBlock(startX + i*80 + 40, startY-70, 100, 20, 'stone');
                        }
                        createPig(startX + 120, startY - 100);
                    }
                }
            ];

            function init() {
                // 1. åŸºç¡€è®¾ç½®
                engine = Engine.create();
                const container = document.getElementById('game-container');
                render = Render.create({
                    element: container,
                    engine: engine,
                    options: {
                        width: window.innerWidth,
                        height
